---
import BaseLayout from "@/layouts/BaseLayout.astro";
import { getCollection } from "astro:content";
import type { CollectionEntry } from "astro:content";
import { BlogPage } from "@/components/pages/BlogPage";
import { siteConfig } from "@/site.config";

const allPosts: CollectionEntry<"blog">[] = (await getCollection("blog")).sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

const title = "Blog";
const description =
  "Articles about software development, AI/ML, open source, and technology by " +
  siteConfig.author.name;

function getReadingTime(content: string | undefined): number {
  const wordsPerMinute = 200;
  const wordCount = content?.split(/\s+/).length || 0;
  return Math.ceil(wordCount / wordsPerMinute);
}

const posts = allPosts.map((post) => ({
  id: post.id,
  title: post.data.title,
  description: post.data.description || "",
  pubDate: post.data.pubDate.toISOString(),
  author: post.data.author,
  tags: post.data.tags || [],
  readingTime: getReadingTime(post.body),
}));

const allTags = [...new Set(allPosts.flatMap((post) => post.data.tags || []))];
---

<BaseLayout title={title} description={description} isBlogListPage={true}>
  <div class="fixed inset-0 -z-50 pointer-events-none">
    <div
      class="absolute inset-0 bg-[linear-gradient(to_right,#8080800a_1px,transparent_1px),linear-gradient(to_bottom,#8080800a_1px,transparent_1px)] bg-size-[14px_24px]"
    >
    </div>
    <div
      class="absolute top-0 left-0 right-0 h-125 bg-linear-to-b from-primary/5 to-transparent"
    >
    </div>
  </div>

  <BlogPage client:load posts={posts} allTags={allTags} />
</BaseLayout>
